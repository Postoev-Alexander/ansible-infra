services:
  postgres:
    image: postgres:17.6
    container_name: "{{ postgres_project_name }}"
    restart: always
    ports:
      - "5432:5432"
    environment:
      POSTGRES_DB: "{{ postgres_db_name }}"
      POSTGRES_USER: "{{ postgres_db_user }}"
      POSTGRES_PASSWORD: "{{ postgres_db_password }}"

    volumes:
      - "{{ postgres_volume_name }}:/var/lib/postgresql/data"
      - "{{ postgres_config_path }}/certs/server.crt:/etc/ssl/certs/server.crt:ro"
      - "{{ postgres_config_path }}/certs/server.key:/etc/ssl/private/server.key:ro"
      - "{{ postgres_config_path }}/postgresql.conf:/etc/postgresql/postgresql.conf:ro"
      - "{{ postgres_config_path }}/pg_hba.conf:/etc/postgresql/pg_hba.conf:ro"
    command: postgres -c config_file=/etc/postgresql/postgresql.conf -c hba_file=/etc/postgresql/pg_hba.conf

volumes:
  "{{ postgres_volume_name }}":
    external: true